"use strict";(self.webpackChunkintegration_development_docs=self.webpackChunkintegration_development_docs||[]).push([[942],{4020:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"relay-module/module-auth","title":"Using Auth in a Module","description":"The next thing we need to do is allow our module to read the authentication headers sent to it. These credentials will be used to make all API calls the module may need to do.","source":"@site/mdx-docs/relay-module/02-module-auth.mdx","sourceDirName":"relay-module","slug":"/relay-module/module-auth","permalink":"/xdr-integration-development-docs/docs/relay-module/module-auth","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Creating a Module Type","permalink":"/xdr-integration-development-docs/docs/relay-module/create-module-type"},"next":{"title":"Dashboard Tile Development","permalink":"/xdr-integration-development-docs/docs/category/dashboard-tile-development"}}');var a=n(4848),o=n(8453);const r={sidebar_position:2},i="Using Auth in a Module",l={},d=[{value:"Create helper utilities",id:"create-helper-utilities",level:2}];function h(e){const t={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"using-auth-in-a-module",children:"Using Auth in a Module"})}),"\n",(0,a.jsx)(t.p,{children:"The next thing we need to do is allow our module to read the authentication headers sent to it. These credentials will be used to make all API calls the module may need to do."}),"\n",(0,a.jsx)(t.p,{children:"In this section we will create a helper function to pull the credentials from the header of the file so they can be used elsewhere in the module."}),"\n",(0,a.jsx)(t.h2,{id:"create-helper-utilities",children:"Create helper utilities"}),"\n",(0,a.jsxs)(t.p,{children:["In your IDE, create a new folder at the root level of the project called ",(0,a.jsx)(t.strong,{children:"utils"}),". THis will be where we create out helper functions."]}),"\n",(0,a.jsxs)(t.p,{children:["In this folder create a new file called ",(0,a.jsx)(t.strong,{children:"auth.js"})]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"auth helper",src:n(9661).A+"",width:"242",height:"389"})}),"\n",(0,a.jsx)(t.p,{children:"The authentication helpers will be used by each API route we make in the future. So it will be called by each route when it is initially queried and then it will pull out the credentials and get our Wazuh API token."}),"\n",(0,a.jsxs)(t.p,{children:["In the blank ",(0,a.jsx)(t.em,{children:"auth.js"})," file, paste the following code. This code will be used to parse the basic authentication token and get us the username and password that was sent in it."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",children:"import axios from 'axios';\nimport https from 'https';\n\nmodule.exports = {\n  getAuthHeaders: async function (headers) {\n    const auth = new Buffer.from(headers.split(' ')[1], 'base64')\n      .toString()\n      .split(':');\n    const user = auth[0];\n    const pass = auth[1];\n    return { user, pass };\n  },\n};\n"})}),"\n",(0,a.jsxs)(t.p,{children:["The above code exports an object of functions. the ",(0,a.jsx)(t.em,{children:"module.exports"})," is the exporting function that Node uses to export data or functions to be used in other files. The next thing we do is name the entry and then set the function along with what it will do. In this case, we are parsing the auth headers."]}),"\n",(0,a.jsx)(t.p,{children:"Next we need to get the authentication token that Wazuh requires. Wazuh requires us to call their authentication API with a username and password and then it will return a JWT token for us to use for the rest of the API calls. The below is the code needed to make that call."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",children:"  getToken: async function (user, pass) {\n    const instance = axios.create({\n      httpsAgent: new https.Agent({ rejectUnauthorized: false }),\n    });\n    const response = await instance.post(\n      'https://ec2-3-134-247-125.us-east-2.compute.amazonaws.com:55000/security/user/authenticate',\n      '',\n      {\n        params: {\n          raw: 'true',\n        },\n        auth: {\n          username: user,\n          password: pass,\n        },\n      }\n    );\n\n    const token = await response.data;\n    return token;\n  },\n"})}),"\n",(0,a.jsx)(t.p,{children:"The entire file should look similar to the below:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",metastring:'title="auth.js"',children:"import axios from 'axios';\nimport https from 'https';\n\nmodule.exports = {\n  getAuthHeaders: async function (headers) {\n    const auth = new Buffer.from(headers.split(' ')[1], 'base64')\n      .toString()\n      .split(':');\n    const user = auth[0];\n    const pass = auth[1];\n    return { user, pass };\n  },\n  getToken: async function (user, pass) {\n    const instance = axios.create({\n      httpsAgent: new https.Agent({ rejectUnauthorized: false }),\n    });\n    const response = await instance.post(\n      'https://ec2-3-134-247-125.us-east-2.compute.amazonaws.com:55000/security/user/authenticate',\n      '',\n      {\n        params: {\n          raw: 'true',\n        },\n        auth: {\n          username: user,\n          password: pass,\n        },\n      }\n    );\n\n    const token = await response.data;\n    return token;\n  },\n};\n"})}),"\n",(0,a.jsx)(t.p,{children:"With the authentication helper finished, we can now use it in other parts of our code."}),"\n",(0,a.jsx)(t.p,{children:"Lets start creating additional functionality in our module starting with Dashboard Tiles"})]})}function u(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>i});var s=n(6540);const a={},o=s.createContext(a);function r(e){const t=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(o.Provider,{value:t},e.children)}},9661:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/utils-folder-b7523da510a48ea53f9cd1de8cd392f5.png"}}]);