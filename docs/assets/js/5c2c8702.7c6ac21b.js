"use strict";(self.webpackChunkintegration_development_docs=self.webpackChunkintegration_development_docs||[]).push([[207],{948:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/module-type-get-c9ca7dbd2ecea022f7d8177dc9e4ac4b.png"},2291:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/patch-data-37120e197c7cce932cece10424ad617b.png"},4684:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/tile-route-f8cf23a3e536dd0fd9f9d2b12c7c1e7c.png"},4810:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/wazuh-agent-tile-8bd32ef1c0ad84e0ffb96c3c3fa110cc.png"},5129:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"relay-module/dashboard-tiles/wazuh-dashboard-tiles","title":"Creating Dashboard Tiles (with Wazuh)","description":"Dashboard Type Examples","source":"@site/mdx-docs/relay-module/dashboard-tiles/01-wazuh-dashboard-tiles.mdx","sourceDirName":"relay-module/dashboard-tiles","slug":"/relay-module/dashboard-tiles/wazuh-dashboard-tiles","permalink":"/xdr-integration-development-docs/docs/relay-module/dashboard-tiles/wazuh-dashboard-tiles","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Creating a Dashboard (F1 Style)","permalink":"/xdr-integration-development-docs/docs/relay-module/dashboard-tiles/f1-dashboard-tiles"},"next":{"title":"Investigate Feature Development","permalink":"/xdr-integration-development-docs/docs/category/investigate-feature-development"}}');var s=n(4848),i=n(8453);n(5537),n(9329);const o={sidebar_position:2},r="Creating Dashboard Tiles (with Wazuh)",l={},d=[{value:"Dashboard Type Examples",id:"dashboard-type-examples",level:2},{value:"Module Type updates",id:"module-type-updates",level:2},{value:"Get a Module ID",id:"get-a-module-id",level:3},{value:"Add Dashboard Tile functionality",id:"add-dashboard-tile-functionality",level:3},{value:"Create Time Helper functions",id:"create-time-helper-functions",level:2},{value:"Create Tile Types Definition",id:"create-tile-types-definition",level:2},{value:"Create Tiles Route",id:"create-tiles-route",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"creating-dashboard-tiles-with-wazuh",children:"Creating Dashboard Tiles (with Wazuh)"})}),"\n",(0,s.jsx)(t.h2,{id:"dashboard-type-examples",children:"Dashboard Type Examples"}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsxs)(t.p,{children:["To get more dashboard tile types, try using this ",(0,s.jsx)(t.a,{href:"https://xdr.us.security.cisco.com/control-center?demo-tiles=1",children:"link"})," to get more examples of the dashboards and add them to your XDR instance",(0,s.jsx)(t.a,{href:"https://xdr.us.security.cisco.com/control-center?demo-tiles=1"})]})}),"\n",(0,s.jsx)(t.h2,{id:"module-type-updates",children:"Module Type updates"}),"\n",(0,s.jsx)(t.h3,{id:"get-a-module-id",children:"Get a Module ID"}),"\n",(0,s.jsxs)(t.p,{children:["Lets get the our module's ID so we can update. Find the ",(0,s.jsx)(t.strong,{children:"ModuleType"})," routes and go to the ",(0,s.jsx)(t.strong,{children:"GET"})," request route ",(0,s.jsx)(t.em,{children:"/iroh/iroh-int/module-type"}),".\n",(0,s.jsx)(t.img,{alt:"get relay",src:n(948).A+"",width:"982",height:"393"})]}),"\n",(0,s.jsxs)(t.p,{children:["Click on ",(0,s.jsx)(t.strong,{children:"Try it out"})," and then ",(0,s.jsx)(t.strong,{children:"Execute"}),". This will get all of the modules you have in XDR. In the blob of JSON that is returned search for ",(0,s.jsx)(t.em,{children:"Wazuh"})," and search for the ",(0,s.jsx)(t.em,{children:"id"})," field in the entry for Wazuh. Save this ID so we can use it later."]}),"\n",(0,s.jsx)(t.p,{children:"Now that we have our module ID, we can update the module functionality for tiles data."}),"\n",(0,s.jsx)(t.h3,{id:"add-dashboard-tile-functionality",children:"Add Dashboard Tile functionality"}),"\n",(0,s.jsxs)(t.p,{children:["To add the tiles functionality we need to to use the below JSON to ",(0,s.jsx)(t.strong,{children:"PATCH"})," our module."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:'{\n  "properties": {\n    "supported-apis": ["health", "tiles", "tiles/tile", "tiles/tile-data"]\n  },\n  "capabilities": [\n    {\n      "id": "tiles",\n      "description": "Wazuh Tiles"\n    },\n    {\n      "id": "health",\n      "description": "health check for Wazuh module"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsxs)(t.admonition,{type:"danger",children:[(0,s.jsx)(t.p,{children:"You have to append to the capabilities list and to the supported apis list for the functionality you want to add to work. If you only input the tiles endpoint it will update the module to only use the tiles endpoint. Appending the tiles to the health endpoint and then patching will allow the module to use both."}),(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsx)(t.p,{children:"It is very important to use double quotes here or the swagger docs will not send the request."})})]}),"\n",(0,s.jsxs)(t.p,{children:["Copy the above snippet and find the ",(0,s.jsx)(t.strong,{children:"ModuleType"})," routes for ",(0,s.jsx)(t.strong,{children:"PATCH"})," ",(0,s.jsx)(t.em,{children:"/iroh/iroh-int/module-type/{id}"})]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"patch relay",src:n(8837).A+"",width:"851",height:"271"})}),"\n",(0,s.jsxs)(t.p,{children:["Click on ",(0,s.jsx)(t.strong,{children:"Try it out"}),", paste the module ID in the ",(0,s.jsx)(t.strong,{children:"id"})," field and then paste the JSON above into the ",(0,s.jsx)(t.strong,{children:"PatchModuleTypeParams"})," field."]}),"\n",(0,s.jsx)(t.p,{children:"Your update should look similar to the below:"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"patched relay",src:n(2291).A+"",width:"908",height:"672"})}),"\n",(0,s.jsx)(t.p,{children:"If you look in the response, you should see there is a section for supported APIs and capabilities. Both of these should list the various tile endpoints in them."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"tiles api enabled",src:n(5242).A+"",width:"491",height:"454"})}),"\n",(0,s.jsx)(t.p,{children:"Before we continue with the tile development, there are some helper functions we need to create to make our development easier. Most notably, we will need to create helper functions to get various time frames that Cisco XDR Tiles will use to display data and query."}),"\n",(0,s.jsx)(t.h2,{id:"create-time-helper-functions",children:"Create Time Helper functions"}),"\n",(0,s.jsxs)(t.p,{children:["In the ",(0,s.jsx)(t.strong,{children:"utils"})," folder, create a new file called ",(0,s.jsx)(t.strong,{children:"time.js"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"In this file, we will export a few functions that will get the current time, 1 hour ago, 24 hours ago, and 1 month ago."}),"\n",(0,s.jsx)(t.p,{children:"Here is the code needed to do that. Note that these are returned in epoch time for easy conversion and comparisons."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",metastring:'title="time.js"',children:"module.exports = {\n  getNow: function () {\n    const date = new Date();\n    const epochTimeInSeconds = Math.floor(Date.now() / 1000);\n    return epochTimeInSeconds;\n  },\n  getHourAgo: function (nowTime) {\n    return nowTime - 3600;\n  },\n  getDayAgo: function (nowTime) {\n    return nowTime - 86400;\n  },\n  getMonthAgo: function (nowTime) {\n    return nowTime - 2592000;\n  },\n};\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Lastly, we need to make a ",(0,s.jsx)(t.strong,{children:"Tile Type"})," definition. This definition is used by Cisco XDR to determine what types of Dashboard Tiles are available to display in Cisco XDR."]}),"\n",(0,s.jsx)(t.h2,{id:"create-tile-types-definition",children:"Create Tile Types Definition"}),"\n",(0,s.jsx)(t.p,{children:"We will work with one type of chart for this example, but you can use the example data from earlier in this section to make more."}),"\n",(0,s.jsxs)(t.p,{children:["In the ",(0,s.jsx)(t.strong,{children:"utils"})," folder, create a new file called ",(0,s.jsx)(t.strong,{children:"tileTypes.js"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Within the ",(0,s.jsx)(t.strong,{children:"tileTypes.js"})," file, paste in the below code:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"module.exports = [\n  {\n    id: 'wazuh_agent_status',\n    type: 'donut_graph',\n    periods: ['last_hour', 'last_24_hours', 'last_7_days'],\n    title: 'Wazuh Agent Status',\n    short_description: 'Quick overview of the current status of Wazuh Agents',\n    description: '',\n    tags: ['wazuh', 'agents'],\n  },\n];\n"})}),"\n",(0,s.jsx)(t.p,{children:"Now let us create our tiles route and get data flowing into Cisco XDR."}),"\n",(0,s.jsx)(t.h2,{id:"create-tiles-route",children:"Create Tiles Route"}),"\n",(0,s.jsxs)(t.p,{children:["In your IDE, create new folder within the ",(0,s.jsx)(t.strong,{children:"Routes"})," folder called ",(0,s.jsx)(t.strong,{children:"tiles"}),". Within this ",(0,s.jsx)(t.strong,{children:"tiles"})," folder, create a file called ",(0,s.jsx)(t.strong,{children:"tileRoute.js"}),"."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"tiles route",src:n(4684).A+"",width:"238",height:"358"})}),"\n",(0,s.jsxs)(t.p,{children:["Add the below code into the ",(0,s.jsx)(t.strong,{children:"tileRoute.js"})," file."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",metastring:'title="tileRoute.js"',children:"const axios = require('axios');\nconst https = require('https');\nconst tileTypes = require('../../utils/tileTypes.js');\nconst timeFunctions = require('../../utils/time.js');\nconst authFunctions = require('../../utils/auth.js');\n\nconst instance = axios.create({\n  httpsAgent: new https.Agent({ rejectUnauthorized: false }),\n});\n\nmodule.exports = (app) => {\n  app.post('/tiles', async (req, res) => {\n    res.send({ data: tileTypes });\n  });\n};\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The above code imports the time helpers, auth helpers, and the tileTypes we created earlier. Then we create a new route for ",(0,s.jsx)(t.em,{children:"/tiles"}),", that when it is queried, it will return the tileTypes we made. This is important because this is what allows Cisco XDR to know what the supported tiles are and how they should be displayed."]}),"\n",(0,s.jsx)(t.p,{children:"After this has been done, you can go into Cisco XDR and look to add a new tile in the Dashboard."}),"\n",(0,s.jsxs)(t.p,{children:["Here is what it should look like in Cisco XDR:\n",(0,s.jsx)(t.img,{alt:"tile lists",src:n(7069).A+"",width:"972",height:"519"})]}),"\n",(0,s.jsxs)(t.p,{children:["Next, lets add another route to the ",(0,s.jsx)(t.em,{children:"module.exports"})," object:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",metastring:'title="tileRoute.js"',children:"app.post('/tiles/tile-data', async (req, res) => {\n  // highlight-start\n  //get auth\n  const auth = req.headers.authorization;\n  const authentication = await authFunctions.getAuthHeaders(auth);\n  const token = await authFunctions.getToken(\n    authentication[0],\n    authentication[1]\n  );\n  // highlight-end\n\n  // get timeframe\n  // highlight-start\n  const postBody = req.body;\n  const period = postBody.period;\n  const tileId = postBody.tile_id;\n  // highlight-end\n\n  const nowTime = timeFunctions.getNow();\n  const hourAgo = timeFunctions.getHourAgo(nowTime);\n  const nowDate = new Date(nowTime * 1000);\n  const hourDate = new Date(hourAgo * 1000);\n  let timeFrame;\n  let tileData;\n\n  if (period === 'last_hour') {\n    timeFrame = timeFunctions.getHourAgo(nowTime);\n  }\n  if (period === 'last_24_hours') {\n    timeFrame = timeFunctions.getDayAgo(nowTime);\n  }\n  if (period === 'last_week') {\n    timeFrame = timeFunctions.getMonthAgo(nowTime);\n  }\n  if (period === 'last_month') {\n    timeFrame = timeFunctions.getMonthAgo(nowTime);\n  }\n  // switch between tile type to get relevant data requested\n  // highlight-start\n  if (tileId === 'wazuh_agent_status') {\n    const agent_status = await instance.get(\n      'https://wazuh_url:55000/overview/agents',\n      {\n        headers: {\n          Authorization: `Bearer ${token}`,\n          'Content-Type': 'application/json',\n        },\n      }\n    );\n    // highlight-end\n\n    const agent_status_data = await agent_status.data.data.agent_status\n      .connection;\n    const agent_status_resolved = await agent_status_data;\n    res.send({\n      data: {\n        tile_id: 'wazuh_agent_status',\n        cache_scope: 'org',\n        labels: [['Active', 'Disconnected', 'Never Connected', 'Pending']],\n        valid_time: {\n          start_time: hourDate,\n          end_time: nowDate,\n        },\n        observed_time: {\n          start_time: hourDate,\n          end_time: nowDate,\n        },\n        observable_type: false,\n        data: [\n          {\n            tooltip: 'Active',\n            value: agent_status_data.active,\n            key: 0,\n          },\n          {\n            tooltip: 'Disconnected',\n            value: agent_status_data.disconnected,\n            key: 1,\n          },\n          {\n            tooltip: 'Never Connected',\n            value: agent_status_data.never_connected,\n            key: 2,\n          },\n          {\n            tooltip: 'Pending',\n            value: agent_status_data.pending,\n            key: 3,\n          },\n        ],\n      },\n    });\n  }\n  //end agent status tile\n});\n"})}),"\n",(0,s.jsx)(t.p,{children:"In the above code, the first highlighted section is us getting our authentication token for the following api calls needed. The second highlighted section is important for how we know what tile data we should get and the timeframe for which is has been requested."}),"\n",(0,s.jsx)(t.p,{children:"Then we have a switch or if statement tree where we perform an action to get the tile data for the requested tile and return it in a format that Cisco XDR expects. Then Cisco XDR will display it like so."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"wazuh agent tile",src:n(4810).A+"",width:"920",height:"545"})}),"\n",(0,s.jsx)(t.p,{children:"Now lets create some endpoints for the Investigate feature set."})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},5242:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/tiles-api-enabled-0b1d20f129b2fc8a56dbc48d454cebe2.png"},5537:(e,t,n)=>{n.d(t,{A:()=>v});var a=n(6540),s=n(4164),i=n(5627),o=n(6347),r=n(372),l=n(604),d=n(1861),c=n(8749);function h(e){return a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=t??function(e){return h(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:s}}=e;return{value:t,label:n,attributes:a,default:s}}))}(n);return function(e){const t=(0,d.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function p(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:n}=e;const s=(0,o.W6)(),i=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l.aZ)(i),(0,a.useCallback)((e=>{if(!i)return;const t=new URLSearchParams(s.location.search);t.set(i,e),s.replace({...s.location,search:t.toString()})}),[i,s])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:s}=e,i=u(e),[o,l]=(0,a.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:i}))),[d,h]=m({queryString:n,groupId:s}),[g,f]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[s,i]=(0,c.Dv)(n);return[s,(0,a.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:s}),w=(()=>{const e=d??g;return p({value:e,tabValues:i})?e:null})();(0,r.A)((()=>{w&&l(w)}),[w]);return{selectedValue:o,selectValue:(0,a.useCallback)((e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),h(e),f(e)}),[h,f,i]),tabValues:i}}var f=n(9136);const w={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=n(4848);function b(e){let{className:t,block:n,selectedValue:a,selectValue:o,tabValues:r}=e;const l=[],{blockElementScrollPositionUntilNextRender:d}=(0,i.a_)(),c=e=>{const t=e.currentTarget,n=l.indexOf(t),s=r[n].value;s!==a&&(d(t),o(s))},h=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;t=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;t=l[n]??l[l.length-1];break}}t?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},t),children:r.map((e=>{let{value:t,label:n,attributes:i}=e;return(0,x.jsx)("li",{role:"tab",tabIndex:a===t?0:-1,"aria-selected":a===t,ref:e=>{l.push(e)},onKeyDown:h,onClick:c,...i,className:(0,s.A)("tabs__item",w.tabItem,i?.className,{"tabs__item--active":a===t}),children:n??t},t)}))})}function j(e){let{lazy:t,children:n,selectedValue:i}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===i));return e?(0,a.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:o.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==i})))})}function y(e){const t=g(e);return(0,x.jsxs)("div",{className:(0,s.A)("tabs-container",w.tabList),children:[(0,x.jsx)(b,{...t,...e}),(0,x.jsx)(j,{...t,...e})]})}function v(e){const t=(0,f.A)();return(0,x.jsx)(y,{...e,children:h(e.children)},String(t))}},7069:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/wazuh-tile-list-a507780c7638cd4c65438e7f19ad05f3.png"},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var a=n(6540);const s={},i=a.createContext(s);function o(e){const t=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(i.Provider,{value:t},e.children)}},8837:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/module-patch-ceff24059c0669952a910ca0ec05a04b.png"},9329:(e,t,n)=>{n.d(t,{A:()=>o});n(6540);var a=n(4164);const s={tabItem:"tabItem_Ymn6"};var i=n(4848);function o(e){let{children:t,hidden:n,className:o}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,a.A)(s.tabItem,o),hidden:n,children:t})}}}]);